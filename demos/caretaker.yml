---
name: caretaker
category: network
workshop_type:
  - network
  - demo
controller_validate_certs: false
tower_infra_workloads:
  - redhat_cop.controller_configuration.projects
  - redhat_cop.controller_configuration.credential_types
  - redhat_cop.controller_configuration.credentials
  - redhat_cop.controller_configuration.job_templates
  - redhat_cop.controller_configuration.workflow_job_templates

controller_projects:
  - name: "Caretaker-Demo"
    description: "Main deploy repo"
    organization: "Default"
    scm_type: git
    scm_update_on_launch: true
    scm_update_cache_timeout: 3600
    wait: true
    scm_url: "https://github.com/redhattelco/caretaker-demo.git"

  - name: "Caretaker-Collection"
    description: "Caretaker collection"
    organization: "Default"
    scm_type: git
    scm_update_on_launch: true
    scm_update_cache_timeout: 3600
    wait: true
    scm_url: "https://github.com/redhattelco/caretaker_collection.git"

controller_credential_types:
  - name: "caretaker-demo-git-key"
    description: "credential to store deploy key"
    kind: cloud
    inputs:
      fields:
        - id: my_private_key
          type: string
          label: private_key
          secret: true
          multiline: true
    injectors:
      file:
        template.my_key: "{% raw %}{  { my_private_key  }}{% endraw %}"
      extra_vars:
        secret_key: "{% raw %}{  { tower.filename.my_key  }}{% endraw %}"

controller_credentials:
  - name: "Caretaker-Demo: credential"
    description: Credentials for caretaker deploy key
    organization: "Default"
    credential_type: "caretaker-demo-git-key"

controller_templates:
  - name: "Caretaker-Demo: Main Deploy Task"
    job_type: run
    inventory: "Workshop Inventory"
    project: "Caretaker-Demo"
    playbook: "deploy.yml"
    execution_environment: "Ansible Engine 2.9 execution environment"
    credentials:
    - "Caretaker-Demo: credential"
    - "Workshop Credential"

  - name: "Caretaker-Demo: Backup device configs"
    job_type: run
    inventory: "Workshop Inventory"
    project: "Caretaker-Demo"
    playbook: "git-push.yaml"
    execution_environment: "Ansible Engine 2.9 execution environment"
    credentials:
    - "Caretaker-Demo: credential"
    - "Workshop Credential"

  - name: "Caretaker: Sync to SoT from devices"
    job_type: run
    inventory: "Workshop Inventory"
    project: "Caretaker-Demo"
    execution_environment: "Ansible Engine 2.9 execution environment"
    playbook: "git-push.yaml"
    credentials:
    - "Caretaker-Demo: credential"
    - "Workshop Credential"

  - name: "Caretaker: Sync from SoT to devices"
    job_type: run
    inventory: "Workshop Inventory"
    project: "Caretaker-Collection"
    execution_environment: "Ansible Engine 2.9 execution environment"
    playbook: "playbooks/sync_to_devices.yml"
    credentials:
    - "Caretaker-Demo: credential"
    - "Workshop Credential"

  - name: "Caretaker: Open a ticket"
    job_type: run
    inventory: "Workshop Inventory"
    project: "Caretaker-Demo"
    execution_environment: "Ansible Engine 2.9 execution environment"
    playbook: "open_ticket.yml"
    credentials:
    - "Workshop Credential"

controller_workflows:
  - name: "Caretaker Demo Workflow"
    organization:
      name: "Default"
    webhook_service: "github"
    workflow_nodes:
      - unified_job_template:
          name: "Caretaker-Demo"
          type: job_template
          organization:
            name: "Default"
        identifier: node101
        related:
          success_nodes:
            - identifier: node201
          failure_nodes: []
          always_nodes: []
      - unified_job_template:
          name: "Caretaker-Demo: Main Deploy Task"
          type: job_template
          organization:
            name: "Default"
        identifier: node201
        related:
          success_nodes:
          - identifier: node301
          failure_nodes:
          - identifier: node302
          always_nodes: []
      - unified_job_template:
          name: "Caretaker-Demo: Backup device configs"
          type: job_template
          organization:
            name: "Default"
        identifier: node301
        related:
          success_nodes: []
          failure_nodes: []
          always_nodes: []
      - unified_job_template:
          name: "Sync to Devices"
          type: workflow_approval
          organization:
            name: "Default"
        related:
          success_nodes:
            - identifier: node401
          failure_nodes:
            - identifier: node402
          always_nodes: []
        identifier: node302
      - unified_job_template:
          name: "Sync to SoT"
          type: workflow_approval
          organization:
            name: "Default"
        identifier: node402
        related:
          success_nodes:
          - identifier: node501
          failure_nodes:
            - identifier: node502
          always_nodes: []
      - unified_job_template:
          name: "Caretaker: Sync from SoT to devices"
          type: job_template
          organization:
            name: "Default"
        identifier: node401
        related:
          success_nodes:
          - identifier: node601
          failure_nodes: []
          always_nodes: []
      - unified_job_template:
          name: "Caretaker: Sync to SoT from devices"
          type: job_template
          organization:
            name: "Default"
        identifier: node501
        related:
          success_nodes:
          - identifier: node601
          failure_nodes: []
          always_nodes: []
      - unified_job_template:
          name: "Caretaker: Open a ticket"
          type: job_template
          organization:
            name: "Default"
        identifier: node502
        related:
          success_nodes: []
          failure_nodes: []
          always_nodes: []
      - unified_job_template:
          name: "Caretaker-Demo: Main Deploy Task"
          type: job_template
          organization:
            name: "Default"
        identifier: node601
        related:
          success_nodes:
          - identifier: node701
          failure_nodes: []
          always_nodes: []
      - unified_job_template:
          name: "Caretaker-Demo: Backup device configs"
          type: job_template
          organization:
            name: "Default"
        identifier: node701
