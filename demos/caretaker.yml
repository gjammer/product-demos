---
name: caretaker
category: network
workshop_type:
  - network
  - demo
tower_validate_certs: false
tower_infra_workloads:
  - redhat_cop.tower_configuration.projects
  - redhat_cop.tower_configuration.credential_types
  - redhat_cop.tower_configuration.credentials
  - redhat_cop.tower_configuration.job_templates
  - redhat_cop.tower_configuration.workflow_job_templates

controller_projects:
  - name: "Caretaker-Demo"
    description: "Main deploy repo"
    organization: "REDHAT NETWORK ORGANIZATION"
    scm_type: git
    scm_update_on_launch: true
    scm_update_cache_timeout: 3600
    wait: true
    scm_url: "https://github.com/redhattelco/caretaker-demo.git"

  - name: "Caretaker-Collection"
    description: "Caretaker collection"
    organization: "REDHAT NETWORK ORGANIZATION"
    scm_type: git
    scm_update_on_launch: true
    scm_update_cache_timeout: 3600
    wait: true
    scm_url: "https://github.com/redhattelco/caretaker_collection.git"

controller_credential_types:
  - name: "caretaker-demo-git-key"
    description: "credential to store deploy key"
    kind: cloud
    inputs:
      fields:
        - id: my_private_key
          type: string
          label: private_key
          secret: true
          multiline: true
    injectors:
      file:
        template.my_key: "{% raw %}{  { my_private_key  }}{% endraw %}"
      extra_vars:
        secret_key: "{% raw %}{  { tower.filename.my_key  }}{% endraw %}"

controller_credentials:
  - name: "Caretaker-Demo: credential"
    description: Credentials for caretaker deploy key
    organization: "REDHAT NETWORK ORGANIZATION"
    credential_type: "caretaker-demo-git-key"

templates:
  - name: "Caretaker-Demo: Main Deploy Task"
    job_type: run
    inventory: "Workshop Inventory"
    project: "Caretaker-Demo"
    playbook: "deploy.yml"
    credentials:
    - "Caretaker-Demo: credential"
    - "Workshop Credential"

  - name: "Caretaker-Demo: Backup device configs"
    job_type: run
    inventory: "Workshop Inventory"
    project: "Caretaker-Demo"
    playbook: "git-push.yaml"
    credentials:
    - "Caretaker-Demo: credential"
    - "Workshop Credential"

  - name: "Caretaker: Sync to SoT from devices"
    job_type: run
    inventory: "Workshop Inventory"
    project: "Caretaker-Demo"
    playbook: "git-push.yaml"
    credentials:
    - "Caretaker-Demo: credential"
    - "Workshop Credential"

  - name: "Caretaker: Sync from SoT to devices"
    job_type: run
    inventory: "Workshop Inventory"
    project: "Caretaker-Collection"
    playbook: "playbooks/sync_to_devices.yml"
    credentials:
    - "Caretaker-Demo: credential"
    - "Workshop Credential"

  - name: "Caretaker: Open a ticket"
    job_type: run
    inventory: "Workshop Inventory"
    project: "Caretaker-Demo"
    playbook: "open_ticket.yml"
    credentials:
    - "Workshop Credential"

controller_workflows:
  - name: "Caretaker Demo Workflow"
    organization: "REDHAT NETWORK ORGANIZATION"
    webhook_service: "github"
    workflow_nodes:
      - unified_job_template: "Caretaker-Demo"
        identifier: node101
        success_nodes:
          - node201
        failure_nodes: []
        always_nodes: []
      - unified_job_template: "Caretaker-Demo: Main Deploy Task"
        identifier: node201
        success_nodes:
          - node301
        failure_nodes:
          - node302
        always_nodes: []
      - unified_job_template: "Caretaker-Demo: Backup device configs"
        identifier: node301
        success_nodes: []
        failure_nodes: []
        always_nodes: []
      - approval_node:
          name: "Sync to Devices"
        success_nodes:
          - node401
        failure_nodes: node402
        always_nodes: []
        identifier: node302
      - approval_node:
          name: "Sync to SoT"
        identifier: node402
        success_nodes:
          - node501
        failure_nodes: node502
        always_nodes: []
      - unified_job_template: "Caretaker: Sync from SoT to devices"
        identifier: node401
        success_nodes:
          - node601
        failure_nodes: []
        always_nodes: []
      - unified_job_template: "Caretaker: Sync to SoT from devices"
        identifier: node501
        success_nodes:
          - node601
        failure_nodes: []
        always_nodes: []
      - unified_job_template: "Caretaker: Open a ticket"
        identifier: node502
        success_nodes: []
        failure_nodes: []
        always_nodes: []
      - unified_job_template: "Caretaker-Demo: Main Deploy Task"
        identifier: node601
        success_nodes:
          - node701
        failure_nodes: []
        always_nodes: []
      - unified_job_template: "Caretaker-Demo: Backup device configs"
        identifier: node701
